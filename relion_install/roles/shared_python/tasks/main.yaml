---


- name: Set up Python directory
  file:
    state: directory
    path: "{{ item }}"
  with_items:
  - "{{ python_dir }}"
  - "{{ python_dl_dir }}"
  - "{{ conda_dl_dir }}"

- name: Display message
  debug:
    msg: "Anaconda for Python 2.7 will be installed at {{ python_dir }}. An installer will be downloaded to the download directory there and then run. Output and error messages generated by the installer will be also be located in the download directory. If installation fails, please check those messages first."


- name: Check if Anaconda installation exists
  stat:
    path: "{{conda_install_dir}}bin/"
  register: conda_bin_path

- name: Download Anaconda for Python 2.7 installer
  get_url:
    url: "{{ conda_dl_link }}"
    dest: "{{ conda_dl_dir }}"
    checksum: "{{ conda_dl_checksum }}"
  when: not conda_bin_path.stat.exists

# run Anaconda installer in batch mode (no manual input), and install at {{ python_dir }}
- name: Run Anaconda installer
  shell: "bash {{ conda_installer }} -b -p {{ conda_install_dir }} > anaconda_install.out 2> anaconda_install.err"
  args:
    chdir: "{{ python_dl_dir }}"
  when: not conda_bin_path.stat.exists




- name: Check if mpi4py installation exists
  stat: 
    path: "{{ mpi4py_lib_path }}"
  register: mpi4py_lib_installed_path

- name: Install mpi4py
  include: mpi4py.yaml
  when: not mpi4py_lib_installed_path.stat.exists
